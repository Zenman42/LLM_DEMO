{% extends "base.html" %}

{% block title %}{{ demo_project.name if demo_project else 'Project' }} — LLM Tracker{% endblock %}
{% block page_title %}{{ demo_project.name if demo_project else 'Project' }}{% endblock %}

{% block content %}
{% if demo_project %}
<div id="projectContent">
    <div class="project-header"><div>
        <span class="domain-label">{{ demo_project.domain }}</span>
        <span class="badge">{{ demo_project.search_engine }}</span>
        {% if demo_project.track_llm %}<span class="badge" style="background:var(--accent);color:#fff;margin-left:6px;">LLM</span>{% endif %}
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn btn-primary">Collect SERP</button>
        {% if demo_project.track_llm %}<button class="btn btn-primary" style="background:#805ad5;">Collect LLM</button>{% endif %}
        <a href="/project/{{ demo_project.id }}/settings" class="btn" style="padding:6px 10px;font-size:16px;" title="Project Settings">⚙</a>
    </div></div>

    {% if demo_project.track_llm %}
    <div class="main-tabs-bar">
        <button class="main-tab-btn active">LLM Visibility</button>
        <button class="main-tab-btn">SERP: POS + AI</button>
    </div>
    {% endif %}

    {# Keywords Table #}
    {% if demo_keywords %}
    <div class="engine-section">
        <h2 class="engine-title {{ 'google-title' if demo_engine == 'google' else 'yandex-title' }}">Keywords</h2>
        <div class="table-wrapper"><table class="keywords-table"><thead><tr>
            <th>Keyword</th>
            <th>Position</th>
            <th>Change</th>
            <th>Found URL</th>
            <th>Match</th>
            <th>SERP</th>
        </tr></thead><tbody>
        {% for kw in demo_keywords %}
        <tr>
            <td><code>{{ kw.keyword }}</code></td>
            <td>{% if kw.position and kw.position > 0 %}<span class="pos-badge {{ 'top3' if kw.position <= 3 else 'good' if kw.position <= 10 else 'medium' if kw.position <= 30 else 'poor' }}">{{ kw.position }}</span>{% else %}<span class="muted">50+</span>{% endif %}</td>
            <td>{% if kw.change is not none %}{% if kw.change > 0 %}<span class="change-up">+{{ kw.change }}</span>{% elif kw.change < 0 %}<span class="change-down">{{ kw.change }}</span>{% else %}<span class="change-none">—</span>{% endif %}{% else %}<span class="muted">—</span>{% endif %}</td>
            <td class="url-cell" title="{{ kw.found_url or '' }}">{{ (kw.found_url or '—')[:60] }}{% if kw.found_url and kw.found_url|length > 60 %}...{% endif %}</td>
            <td>{% if kw.match == true %}<span class="match-ok">OK</span>{% elif kw.match == false %}<span class="match-no">X</span>{% else %}<span class="muted">—</span>{% endif %}</td>
            <td><button class="btn btn-sm btn-serp">TOP</button></td>
        </tr>
        {% endfor %}
        </tbody></table></div>
    </div>
    {% else %}
    <div class="empty-state"><p>No keywords tracked. <a href="/settings">Add keywords</a> in settings.</p></div>
    {% endif %}
</div>
{% else %}
<div id="projectContent">
    <div class="empty-state"><p>Project not found.</p></div>
</div>
{% endif %}
{% endblock %}
